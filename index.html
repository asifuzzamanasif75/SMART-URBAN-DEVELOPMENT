<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Urban Development System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        /* Enhanced Navbar */
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            padding: 0.75rem 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            background: linear-gradient(to right, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            flex: 1;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9rem;
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.95);
            color: #667eea;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .icon-btn {
            padding: 0.6rem;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            position: relative;
            backdrop-filter: blur(10px);
            font-size: 1rem;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .icon-btn.logout-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .icon-btn.logout-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: scale(1.05);
        }

        .notification-dot {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .admin-avatar {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .mobile-menu-btn {
            display: none;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Home Page Actions */
        .home-actions {
            text-align: center;
            margin-bottom: 2rem;
        }

        .home-actions h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
        }

        .action-buttons-home {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        #addBtnHome, #addBtnTop {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        #addBtnHome:hover, #addBtnTop:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(17, 153, 142, 0.4);
        }

        #searchBtnHome, #searchBtnTop {
            background: linear-gradient(135deg, #8e2de2 0%, #4a00e0 100%);
        }

        #searchBtnHome:hover, #searchBtnTop:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(142, 45, 226, 0.4);
        }

        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
        }

        .hero-section h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }

        .hero-section p {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.75rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-header h3 {
            font-size: 0.95rem;
            font-weight: 600;
            color: #64748b;
        }

        .stat-icon {
            font-size: 1.75rem;
            padding: 0.75rem;
            border-radius: 12px;
        }

        .stat-icon.red {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .stat-icon.green {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .stat-icon.yellow {
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .stat-icon.blue {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .chart-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            transition: all 0.3s;
        }

        .chart-container:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .chart-container h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chart-container h3 i {
            color: #667eea;
        }

        .chart-container canvas {
            max-height: 300px;
        }

        /* Feature Grid */
        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin: 2rem 0 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title i {
            color: #667eea;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .feature-card {
            background: white;
            padding: 1.75rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(102, 126, 234, 0.25);
            border-color: #667eea;
        }

        .feature-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.25rem;
            border-radius: 16px;
            color: white;
            font-size: 2rem;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .feature-info h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .feature-info p {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .feature-count {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Page Actions */
        .page-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .page-actions h2 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .action-buttons-top {
            display: flex;
            gap: 1rem;
        }

        /* Search Bar */
        .search-bar {
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .search-bar i {
            position: absolute;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 1.1rem;
        }

        .search-bar input {
            width: 100%;
            padding: 0.875rem 1.25rem 0.875rem 3.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        /* Table Styles */
        #dataTable {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        #dataTable thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        #dataTable th {
            padding: 1.25rem 1.5rem;
            text-align: left;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        #dataTable tbody tr {
            transition: all 0.2s;
            border-bottom: 1px solid #f1f5f9;
        }

        #dataTable tbody tr:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05), transparent);
            transform: scale(1.01);
        }

        #dataTable td {
            padding: 1.25rem 1.5rem;
            font-size: 0.9rem;
            color: #334155;
        }

        .action-buttons-table {
            display: flex;
            gap: 0.5rem;
        }

        .action-buttons-table button {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.2s;
            border-radius: 8px;
            font-size: 1.1rem;
        }

        .edit-btn {
            color: #3b82f6;
        }

        .edit-btn:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: scale(1.1);
        }

        .delete-btn {
            color: #ef4444;
        }

        .delete-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            transform: scale(1.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #1e293b;
        }

        .delete-title {
            color: #ef4444;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-body label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #475569;
        }

        .modal-body input,
        .modal-body select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            margin-bottom: 1rem;
        }

        .modal-body input:focus,
        .modal-body select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
        }

        .modal-footer button {
            flex: 1;
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }

        .btn-secondary:hover {
            background: #cbd5e1;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        /* Side Panels */
        .side-panel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.2);
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2000;
            padding: 2rem;
            overflow-y: auto;
        }

        .side-panel.active {
            right: 0;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .panel-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
        }

        .close-btn {
            background: #f1f5f9;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: all 0.3s;
            color: #64748b;
        }

        .close-btn:hover {
            background: #e2e8f0;
            transform: rotate(90deg);
        }

        .notification-list {
            list-style: none;
            padding: 0;
        }

        .notification-list li {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f8fafc;
            transition: all 0.3s;
        }

        .notification-list li:hover {
            background: #f1f5f9;
            transform: translateX(-5px);
        }

        .red { color: #ef4444; }
        .yellow { color: #f59e0b; }
        .green { color: #10b981; }

        /* Responsive */
        @media (max-width: 1024px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
                background: transparent;
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
            }

            .main-content {
                padding: 1rem;
            }

            .hero-section {
                padding: 2rem 1.5rem;
            }

            .hero-section h2 {
                font-size: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }

            .page-actions {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .action-buttons-top {
                width: 100%;
                justify-content: stretch;
            }

            .action-buttons-top .action-btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Horizontal Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-content">
                <div class="logo">
                    <h1>üèôÔ∏è Smart City</h1>
                </div>

                <div class="nav-menu" id="navMenu">
                    <button class="nav-item active" data-page="home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </button>
                    
                    <button class="nav-item" data-page="traffic">
                        <i class="fas fa-car"></i>
                        <span>Traffic</span>
                    </button>
                    
                    <button class="nav-item" data-page="parking">
                        <i class="fas fa-parking"></i>
                        <span>Parking</span>
                    </button>
                    
                    <button class="nav-item" data-page="waste">
                        <i class="fas fa-trash"></i>
                        <span>Waste</span>
                    </button>
                    
                    <button class="nav-item" data-page="energy">
                        <i class="fas fa-bolt"></i>
                        <span>Energy</span>
                    </button>
                    
                    <button class="nav-item" data-page="pollution">
                        <i class="fas fa-wind"></i>
                        <span>Pollution</span>
                    </button>
                    
                    <button class="nav-item" data-page="emergency">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Emergency</span>
                    </button>
                    
                    <button class="nav-item" data-page="authorities">
                        <i class="fas fa-building"></i>
                        <span>Authorities</span>
                    </button>
                    
                    <button class="nav-item" data-page="administrators">
                        <i class="fas fa-user-shield"></i>
                        <span>Administrators</span>
                    </button>
                    
                    <button class="nav-item" data-page="citizens">
                        <i class="fas fa-users"></i>
                        <span>Citizens</span>
                    </button>
                </div>

                <div class="nav-right">
                    <button class="icon-btn" onclick="openPanel('notificationPanel')">
                        <i class="fas fa-bell"></i>
                        <span class="notification-dot"></span>
                    </button>
                    <button class="icon-btn" onclick="openPanel('settingsPanel')">
                        <i class="fas fa-cog"></i>
                    </button>
                    <div class="admin-profile">
                        <div class="admin-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span id="usernameDisplay">User</span>
                    </div>
                    <button class="icon-btn" onclick="logout()" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <script src="api-handler.js"></script>
    <script src="script.js"></script>    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Page -->
        <div id="homePage" class="page-content active">
            <div class="home-actions">
                <h1>Smart Urban Development Dashboard</h1>
                <div class="action-buttons-home">
                    <button class="action-btn" id="refreshBtnHome">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh Data</span>
                    </button>
                    <button class="action-btn" id="addBtnHome">
                        <i class="fas fa-plus"></i>
                        <span>Add New Entry</span>
                    </button>
                    <button class="action-btn" id="searchBtnHome">
                        <i class="fas fa-search"></i>
                        <span>Search Data</span>
                    </button>
                </div>
            </div>

            <div class="search-bar" id="searchBarHome" style="display: none;">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInputHome" placeholder="Search across all modules...">
            </div>

            <div class="hero-section">
                <h2>üåÜ Monitoring and Managing City Infrastructure</h2>
                <p>Real-time data analytics and AI-powered insights for smart city operations</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Active Incidents</h3>
                        <i class="fas fa-exclamation-triangle stat-icon red"></i>
                    </div>
                    <p class="stat-value">5</p>
                    <p class="stat-label">3 high priority</p>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Air Quality Index</h3>
                        <i class="fas fa-wind stat-icon green"></i>
                    </div>
                    <p class="stat-value">108</p>
                    <p class="stat-label">Moderate levels</p>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Energy Usage</h3>
                        <i class="fas fa-bolt stat-icon yellow"></i>
                    </div>
                    <p class="stat-value">13.8k</p>
                    <p class="stat-label">kWh today</p>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <h3>Total Citizens</h3>
                        <i class="fas fa-users stat-icon blue"></i>
                    </div>
                    <p class="stat-value">6</p>
                    <p class="stat-label">Registered</p>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <h3><i class="fas fa-chart-line"></i> Traffic Congestion Analysis</h3>
                    <canvas id="trafficChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3><i class="fas fa-chart-pie"></i> Energy Consumption by Area</h3>
                    <canvas id="energyChart"></canvas>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <h3><i class="fas fa-chart-bar"></i> Air Quality Status</h3>
                    <canvas id="pollutionChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3><i class="fas fa-chart-area"></i> Emergency Response Performance</h3>
                    <canvas id="emergencyChart"></canvas>
                </div>
            </div>

            <h2 class="section-title"><i class="fas fa-th-large"></i> System Modules</h2>
            <div class="feature-grid">
                <div class="feature-card" data-page="traffic">
                    <div class="feature-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="feature-info">
                        <h3>Traffic Management</h3>
                        <p>Monitor real-time traffic flow</p>
                        <span class="feature-count">5 records</span>
                    </div>
                </div>
                <div class="feature-card" data-page="parking">
                    <div class="feature-icon">
                        <i class="fas fa-parking"></i>
                    </div>
                    <div class="feature-info">
                        <h3>Smart Parking</h3>
                        <p>Track parking availability</p>
                        <span class="feature-count">5 facilities</span>
                    </div>
                </div>
                <div class="feature-card" data-page="waste">
                    <div class="feature-icon">
                        <i class="fas fa-trash"></i>
                    </div>
                    <div class="feature-info">
                        <h3>Waste Management</h3>
                        <p>Collection and recycling tracking</p>
                        <span class="feature-count">5 categories</span>
                    </div>
                </div>
                <div class="feature-card" data-page="energy">
                    <div class="feature-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="feature-info">
                        <h3>Energy Monitoring</h3>
                        <p>Energy, water & gas tracking</p>
                        <span class="feature-count">5 zones</span>
                    </div>
                </div>
                <div class="feature-card" data-page="pollution">
                    <div class="feature-icon">
                        <i class="fas fa-wind"></i>
                    </div>
                    <div class="feature-info">
                        <h3>Air Quality</h3>
                        <p>Pollution monitoring system</p>
                        <span class="feature-count">5 stations</span>
                    </div>
                </div>
                <div class="feature-card" data-page="emergency">
                    <div class="feature-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="feature-info">
                        <h3>Emergency Response</h3>
                        <p>Incident management system</p>
                        <span class="feature-count">5 incidents</span>
                    </div>
                </div>
                <div class="feature-card" data-page="authorities">
                    <div class="feature-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="feature-info">
                        <h3>City Authorities</h3>
                        <p>Government departments</p>
                        <span class="feature-count">5 authorities</span>
                    </div>
                </div>
                <div class="feature-card" data-page="administrators">
                    <div class="feature-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="feature-info">
                        <h3>City Administrators</h3>
                        <p>System administrators</p>
                        <span class="feature-count">5 admins</span>
                    </div>
                </div>
                <div class="feature-card" data-page="citizens">
                    <div class="feature-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="feature-info">
                        <h3>Citizens</h3>
                        <p>Registered citizens database</p>
                        <span class="feature-count">6 citizens</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table Pages -->
        <div id="dataPage" class="page-content">
            <div class="page-actions">
                <h2 id="pageTitle"></h2>
                <div class="action-buttons-top">
                    <button class="action-btn" id="refreshBtnTop">
                        <i class="fas fa-sync-alt"></i>
                        <span>Refresh Data</span>
                    </button>
                    <button class="action-btn" id="addBtnTop">
                        <i class="fas fa-plus"></i>
                        <span>Add New</span>
                    </button>
                    <button class="action-btn" id="searchBtnTop">
                        <i class="fas fa-search"></i>
                        <span>Search</span>
                    </button>
                </div>
            </div>

            <div class="search-bar" id="searchBarContainer" style="display: none;">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search...">
            </div>
                
            <table id="dataTable">
                <thead id="tableHead"></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </main>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="side-panel">
        <div class="panel-header">
            <h3>üîî Notifications</h3>
            <button class="close-btn" onclick="closePanel('notificationPanel')">&times;</button>
        </div>
        <ul class="notification-list">
            <li><i class="fas fa-exclamation-triangle red"></i> <span>Traffic congestion detected in Zone 5.</span></li>
            <li><i class="fas fa-bolt yellow"></i> <span>Power usage exceeded threshold in District 3.</span></li>
            <li><i class="fas fa-trash green"></i> <span>Waste bin #204 emptied successfully.</span></li>
        </ul>
    </div>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="side-panel">
        <div class="panel-header">
            <h3>‚öôÔ∏è Settings</h3>
            <button class="close-btn" onclick="closePanel('settingsPanel')">&times;</button>
        </div>
        <div class="settings-options">
            <label><input type="checkbox" checked> Enable Notifications</label>
            <label><input type="checkbox"> Dark Mode</label>
            <button class="btn-primary" onclick="saveSettings()">Save Changes</button>
        </div>
    </div>

    <!-- Add Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h3>‚ûï Add New Entry</h3>
            <div class="modal-body">
                <label for="moduleSelect">Select Module:</label>
                <select id="moduleSelect">
                    <option value="">-- Select Module --</option>
                    <option value="traffic">Traffic Management</option>
                    <option value="parking">Smart Parking</option>
                    <option value="waste">Waste Management</option>
                    <option value="energy">Energy Monitoring</option>
                    <option value="pollution">Air Quality</option>
                    <option value="emergency">Emergency Response</option>
                    <option value="authorities">City Authorities</option>
                    <option value="administrators">City Administrators</option>
                    <option value="citizens">Citizens</option>
                </select>
                <input type="text" id="addInput" placeholder="Enter details...">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('addModal')">Cancel</button>
                <button class="btn-primary" onclick="confirmAdd()">Add</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>‚úèÔ∏è Edit Entry</h3>
            <div class="modal-body">
                <input type="text" id="editInput" placeholder="Edit details...">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('editModal')">Cancel</button>
                <button class="btn-primary" onclick="confirmEdit()">Save</button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3 class="delete-title">üóëÔ∏è Confirm Delete</h3>
            <div class="modal-body">
                <p>Are you sure you want to delete this entry? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('deleteModal')">Cancel</button>
                <button class="btn-danger" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <script>
// ========================================
// SMART URBAN DEVELOPMENT PROJECT - COMPLETE DATABASE
// ========================================

// Feature 1: Smart City Traffic Management
const data = {
    traffic: [
        { 
            id: 1, 
            location: 'Main Street & 5th Avenue', 
            vehicleCount: 245, 
            congestionLevel: 'High', 
            accidents: 2, 
            timestamp: '2025-11-03 08:30:00',
            weatherCondition: 'Clear',
            speedAvg: '15 km/h'
        },
        { 
            id: 2, 
            location: 'Highway 101 Exit 12', 
            vehicleCount: 180, 
            congestionLevel: 'Medium', 
            accidents: 0, 
            timestamp: '2025-11-03 09:15:00',
            weatherCondition: 'Rainy',
            speedAvg: '35 km/h'
        },
        { 
            id: 3, 
            location: 'Central Business District', 
            vehicleCount: 320, 
            congestionLevel: 'High', 
            accidents: 1, 
            timestamp: '2025-11-03 08:45:00',
            weatherCondition: 'Clear',
            speedAvg: '12 km/h'
        },
        { 
            id: 4, 
            location: 'Airport Road Junction', 
            vehicleCount: 95, 
            congestionLevel: 'Low', 
            accidents: 0, 
            timestamp: '2025-11-03 10:00:00',
            weatherCondition: 'Foggy',
            speedAvg: '55 km/h'
        },
        { 
            id: 5, 
            location: 'Industrial Zone Route 7', 
            vehicleCount: 150, 
            congestionLevel: 'Medium', 
            accidents: 1, 
            timestamp: '2025-11-03 07:30:00',
            weatherCondition: 'Clear',
            speedAvg: '40 km/h'
        }
    ],

    parking: [
        { 
            id: 1, 
            location: 'City Center Mall Parking', 
            totalSpots: 200, 
            availableSpots: 45, 
            occupiedSpots: 155,
            parkingType: 'Multi-level',
            hourlyRate: '$3.00',
            status: 'Active'
        },
        { 
            id: 2, 
            location: 'Downtown Plaza', 
            totalSpots: 150, 
            availableSpots: 89, 
            occupiedSpots: 61,
            parkingType: 'Surface',
            hourlyRate: '$2.50',
            status: 'Active'
        },
        { 
            id: 3, 
            location: 'Railway Station Parking', 
            totalSpots: 300, 
            availableSpots: 12, 
            occupiedSpots: 288,
            parkingType: 'Multi-level',
            hourlyRate: '$4.00',
            status: 'Active'
        },
        { 
            id: 4, 
            location: 'Hospital Complex', 
            totalSpots: 180, 
            availableSpots: 67, 
            occupiedSpots: 113,
            parkingType: 'Surface',
            hourlyRate: '$2.00',
            status: 'Active'
        },
        { 
            id: 5, 
            location: 'Sports Stadium', 
            totalSpots: 500, 
            availableSpots: 445, 
            occupiedSpots: 55,
            parkingType: 'Open Ground',
            hourlyRate: '$5.00',
            status: 'Active'
        }
    ],

    waste: [
        { 
            id: 1, 
            wasteCategory: 'Organic', 
            description: 'Food waste, garden waste', 
            recyclingRate: '75%',
            colorCode: 'Green',
            disposalMethod: 'Composting'
        },
        { 
            id: 2, 
            wasteCategory: 'Plastic', 
            description: 'Bottles, containers, packaging', 
            recyclingRate: '60%',
            colorCode: 'Blue',
            disposalMethod: 'Recycling Plant'
        },
        { 
            id: 3, 
            wasteCategory: 'Electronic', 
            description: 'Old devices, batteries, cables', 
            recyclingRate: '45%',
            colorCode: 'Red',
            disposalMethod: 'E-waste Facility'
        },
        { 
            id: 4, 
            wasteCategory: 'Paper', 
            description: 'Newspapers, cardboard, office paper', 
            recyclingRate: '80%',
            colorCode: 'Yellow',
            disposalMethod: 'Paper Mill'
        },
        { 
            id: 5, 
            wasteCategory: 'Metal', 
            description: 'Cans, scrap metal', 
            recyclingRate: '70%',
            colorCode: 'Gray',
            disposalMethod: 'Metal Recycling'
        }
    ],

    energy: [
        { 
            id: 1, 
            area: 'Residential Zone A', 
            energyConsumed: '1500 kWh', 
            waterUsage: '450 L',
            gasUsage: '120 m¬≥',
            date: '2025-11-03',
            status: 'Normal',
            cost: '$180.00',
            peakHours: '06:00 PM - 10:00 PM'
        },
        { 
            id: 2, 
            area: 'Industrial Zone B', 
            energyConsumed: '4200 kWh', 
            waterUsage: '1200 L',
            gasUsage: '350 m¬≥',
            date: '2025-11-03',
            status: 'High',
            cost: '$520.00',
            peakHours: '08:00 AM - 06:00 PM'
        },
        { 
            id: 3, 
            area: 'Commercial Zone C', 
            energyConsumed: '2800 kWh', 
            waterUsage: '800 L',
            gasUsage: '200 m¬≥',
            date: '2025-11-03',
            status: 'Normal',
            cost: '$340.00',
            peakHours: '10:00 AM - 08:00 PM'
        },
        { 
            id: 4, 
            area: 'Hospital Complex', 
            energyConsumed: '3500 kWh', 
            waterUsage: '1500 L',
            gasUsage: '280 m¬≥',
            date: '2025-11-03',
            status: 'Critical',
            cost: '$450.00',
            peakHours: '24/7'
        },
        { 
            id: 5, 
            area: 'Educational Institute', 
            energyConsumed: '1800 kWh', 
            waterUsage: '600 L',
            gasUsage: '150 m¬≥',
            date: '2025-11-03',
            status: 'Normal',
            cost: '$220.00',
            peakHours: '08:00 AM - 04:00 PM'
        }
    ],

    pollution: [
        { 
            id: 1, 
            location: 'Downtown Center', 
            aqi: 145, 
            pm25: '65 ¬µg/m¬≥',
            co2Level: '420 ppm',
            noiseLevel: '75 dB',
            status: 'Moderate',
            timestamp: '2025-11-03 09:00:00',
            alertLevel: 'Yellow'
        },
        { 
            id: 2, 
            location: 'Industrial Area', 
            aqi: 198, 
            pm25: '95 ¬µg/m¬≥',
            co2Level: '580 ppm',
            noiseLevel: '85 dB',
            status: 'Unhealthy',
            timestamp: '2025-11-03 09:00:00',
            alertLevel: 'Orange'
        },
        { 
            id: 3, 
            location: 'Suburban Park', 
            aqi: 78, 
            pm25: '32 ¬µg/m¬≥',
            co2Level: '380 ppm',
            noiseLevel: '45 dB',
            status: 'Good',
            timestamp: '2025-11-03 09:00:00',
            alertLevel: 'Green'
        },
        { 
            id: 4, 
            location: 'Highway Corridor', 
            aqi: 165, 
            pm25: '78 ¬µg/m¬≥',
            co2Level: '495 ppm',
            noiseLevel: '80 dB',
            status: 'Unhealthy for Sensitive',
            timestamp: '2025-11-03 09:00:00',
            alertLevel: 'Yellow'
        },
        { 
            id: 5, 
            location: 'Coastal Area', 
            aqi: 55, 
            pm25: '18 ¬µg/m¬≥',
            co2Level: '360 ppm',
            noiseLevel: '40 dB',
            status: 'Excellent',
            timestamp: '2025-11-03 09:00:00',
            alertLevel: 'Green'
        }
    ],

    emergency: [
        { 
            id: 1, 
            type: 'Fire', 
            location: 'Building A, 23rd Street', 
            reportedBy: 'Citizen Alert',
            status: 'In Progress', 
            priority: 'High',
            timestamp: '2025-11-03 08:45:00',
            assignedUnit: 'Fire Squad 3',
            casualties: '0'
        },
        { 
            id: 2, 
            type: 'Road Accident', 
            location: 'Highway 101, Mile 45', 
            reportedBy: 'Traffic Camera',
            status: 'Resolved', 
            priority: 'Medium',
            timestamp: '2025-11-03 07:30:00',
            assignedUnit: 'Ambulance 7',
            casualties: '2 injured'
        },
        { 
            id: 3, 
            type: 'Medical Emergency', 
            location: 'Park Street Residence', 
            reportedBy: '911 Call',
            status: 'Dispatched', 
            priority: 'High',
            timestamp: '2025-11-03 09:15:00',
            assignedUnit: 'Ambulance 3',
            casualties: '1 critical'
        },
        { 
            id: 4, 
            type: 'Flood Warning', 
            location: 'River Bank Area', 
            reportedBy: 'Weather Station',
            status: 'Monitoring', 
            priority: 'Medium',
            timestamp: '2025-11-03 06:00:00',
            assignedUnit: 'Disaster Team 2',
            casualties: '0'
        },
        { 
            id: 5, 
            type: 'Power Outage', 
            location: 'West District', 
            reportedBy: 'Utility Monitor',
            status: 'Under Repair', 
            priority: 'Low',
            timestamp: '2025-11-03 05:30:00',
            assignedUnit: 'Electric Crew 5',
            casualties: '0'
        }
    ],

    authorities: [
        { 
            id: 1, 
            department: 'Traffic Management', 
            head: 'John Smith', 
            contact: '+1-555-0101', 
            email: 'traffic@smartcity.gov', 
            address: 'City Hall, Floor 3', 
            employees: '45', 
            budget: '$2.5M' 
        },
        { 
            id: 2, 
            department: 'Public Works', 
            head: 'Sarah Johnson', 
            contact: '+1-555-0102', 
            email: 'publicworks@smartcity.gov', 
            address: 'Municipal Building A', 
            employees: '120', 
            budget: '$8.2M' 
        },
        { 
            id: 3, 
            department: 'Environmental Services', 
            head: 'Mike Chen', 
            contact: '+1-555-0103', 
            email: 'environment@smartcity.gov', 
            address: 'Green Tower, Suite 200', 
            employees: '68', 
            budget: '$4.1M' 
        },
        { 
            id: 4, 
            department: 'Emergency Services', 
            head: 'Emily Davis', 
            contact: '+1-555-0104', 
            email: 'emergency@smartcity.gov', 
            address: 'Emergency Command Center', 
            employees: '200', 
            budget: '$12.5M' 
        },
        { 
            id: 5, 
            department: 'Urban Planning', 
            head: 'Robert Wilson', 
            contact: '+1-555-0105', 
            email: 'planning@smartcity.gov', 
            address: 'City Hall, Floor 5', 
            employees: '32', 
            budget: '$3.8M' 
        }
    ],

    administrators: [
        { 
            id: 1, 
            name: 'Admin Smith', 
            role: 'System Administrator', 
            department: 'IT Operations', 
            email: 'admin.smith@smartcity.gov', 
            phone: '+1-555-0201', 
            status: 'Active', 
            lastLogin: '2025-11-03 09:30' 
        },
        { 
            id: 2, 
            name: 'Jane Doe', 
            role: 'Database Administrator', 
            department: 'IT Operations', 
            email: 'jane.doe@smartcity.gov', 
            phone: '+1-555-0202', 
            status: 'Active', 
            lastLogin: '2025-11-03 08:15' 
        },
        { 
            id: 3, 
            name: 'David Lee', 
            role: 'Network Administrator', 
            department: 'Infrastructure', 
            email: 'david.lee@smartcity.gov', 
            phone: '+1-555-0203', 
            status: 'Active', 
            lastLogin: '2025-11-02 18:45' 
        },
        { 
            id: 4, 
            name: 'Maria Garcia', 
            role: 'Security Administrator', 
            department: 'Cybersecurity', 
            email: 'maria.garcia@smartcity.gov', 
            phone: '+1-555-0204', 
            status: 'Active', 
            lastLogin: '2025-11-03 07:00' 
        },
        { 
            id: 5, 
            name: 'Tom Brown', 
            role: 'Application Administrator', 
            department: 'Software Services', 
            email: 'tom.brown@smartcity.gov', 
            phone: '+1-555-0205', 
            status: 'On Leave', 
            lastLogin: '2025-10-28 16:30' 
        }
    ],

    citizens: [
        { 
            id: 1, 
            name: 'Alice Johnson', 
            age: 34, 
            address: '123 Elm Street', 
            phone: '+1-555-1001', 
            email: 'alice.j@email.com', 
            registeredDate: '2024-01-15' 
        },
        { 
            id: 2, 
            name: 'Bob Williams', 
            age: 45, 
            address: '456 Oak Avenue', 
            phone: '+1-555-1002', 
            email: 'bob.w@email.com', 
            registeredDate: '2024-02-20' 
        },
        { 
            id: 3, 
            name: 'Carol Martinez', 
            age: 29, 
            address: '789 Pine Road', 
            phone: '+1-555-1003', 
            email: 'carol.m@email.com', 
            registeredDate: '2024-03-10' 
        },
        { 
            id: 4, 
            name: 'Daniel Brown', 
            age: 52, 
            address: '321 Maple Drive', 
            phone: '+1-555-1004', 
            email: 'daniel.b@email.com', 
            registeredDate: '2024-04-05' 
        },
        { 
            id: 5, 
            name: 'Emma Davis', 
            age: 38, 
            address: '654 Cedar Lane', 
            phone: '+1-555-1005', 
            email: 'emma.d@email.com', 
            registeredDate: '2024-05-12' 
        },
        { 
            id: 6, 
            name: 'Frank Wilson', 
            age: 41, 
            address: '987 Birch Street', 
            phone: '+1-555-1006', 
            email: 'frank.w@email.com', 
            registeredDate: '2024-06-18' 
        }
    ]
};

const titles = {
    traffic: 'Smart City Traffic Management',
    parking: 'Smart Parking - Available Spots',
    waste: 'Waste Management - Categories',
    energy: 'Smart Energy Monitoring System',
    pollution: 'Air Quality & Pollution Monitoring',
    emergency: 'Emergency Response - Active Incidents',
    authorities: 'City Authorities Management',
    administrators: 'City Administrators',
    citizens: 'Citizens Registry'
};

let currentPage = 'home';
let selectedItem = null;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    setupEventListeners();
    showPage('home');
    initializeCharts();
});

// Event Listeners
function setupEventListeners() {
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
            const page = this.getAttribute('data-page');
            showPage(page);
            updateActiveNav(this);
        });
    });

    document.querySelectorAll('.feature-card').forEach(card => {
        card.addEventListener('click', function() {
            const page = this.getAttribute('data-page');
            showPage(page);
            updateActiveNavByPage(page);
        });
    });

    const addBtnHome = document.getElementById('addBtnHome');
    if (addBtnHome) {
        addBtnHome.addEventListener('click', openAddModal);
    }

    const searchBtnHome = document.getElementById('searchBtnHome');
    const searchBarHome = document.getElementById('searchBarHome');
    if (searchBtnHome && searchBarHome) {
        searchBtnHome.addEventListener('click', function() {
            if (searchBarHome.style.display === 'none' || searchBarHome.style.display === '') {
                searchBarHome.style.display = 'block';
                document.getElementById('searchInputHome').focus();
            } else {
                searchBarHome.style.display = 'none';
            }
        });
    }

    const addBtnTop = document.getElementById('addBtnTop');
    if (addBtnTop) {
        addBtnTop.addEventListener('click', openAddModal);
    }

    const searchBtnTop = document.getElementById('searchBtnTop');
    const searchBarContainer = document.getElementById('searchBarContainer');
    if (searchBtnTop && searchBarContainer) {
        searchBtnTop.addEventListener('click', function() {
            if (searchBarContainer.style.display === 'none' || searchBarContainer.style.display === '') {
                searchBarContainer.style.display = 'block';
                document.getElementById('searchInput').focus();
            } else {
                searchBarContainer.style.display = 'none';
            }
        });
    }

    document.getElementById('searchInput').addEventListener('input', function(e) {
        filterTable(e.target.value);
    });

    document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
}

// Page Navigation
function showPage(page) {
    currentPage = page;
    
    if (page === 'home') {
        document.getElementById('homePage').classList.add('active');
        document.getElementById('dataPage').classList.remove('active');
    } else {
        document.getElementById('homePage').classList.remove('active');
        document.getElementById('dataPage').classList.add('active');
        loadTableData(page);
    }
}

function updateActiveNav(element) {
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    element.classList.add('active');
}

function updateActiveNavByPage(page) {
    document.querySelectorAll('.nav-item').forEach(item => {
        if (item.getAttribute('data-page') === page) {
            item.classList.add('active');
        } else {
            item.classList.remove('active');
        }
    });
}

// Table Functions
function loadTableData(page) {
    const pageData = data[page];
    if (!pageData || pageData.length === 0) return;

    document.getElementById('pageTitle').textContent = titles[page];

    const columns = Object.keys(pageData[0]).filter(key => key !== 'id');
    
    const thead = document.getElementById('tableHead');
    thead.innerHTML = '';
    const headerRow = document.createElement('tr');
    
    columns.forEach(col => {
        const th = document.createElement('th');
        th.textContent = col.charAt(0).toUpperCase() + col.slice(1).replace(/([A-Z])/g, ' $1');
        headerRow.appendChild(th);
    });
    
    const actionTh = document.createElement('th');
    actionTh.textContent = 'Actions';
    headerRow.appendChild(actionTh);
    thead.appendChild(headerRow);

    renderTableBody(pageData, columns);
}

function renderTableBody(pageData, columns) {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';

    pageData.forEach(item => {
        const row = document.createElement('tr');
        
        columns.forEach(col => {
            const td = document.createElement('td');
            td.textContent = item[col];
            row.appendChild(td);
        });

        const actionTd = document.createElement('td');
        actionTd.innerHTML = `
            <div class="action-buttons-table">
                <button class="edit-btn" onclick="openEditModal(${item.id})" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="delete-btn" onclick="openDeleteModal(${item.id})" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        row.appendChild(actionTd);
        tbody.appendChild(row);
    });
}
 
function filterTable(searchTerm) {
    const pageData = data[currentPage];
    if (!pageData) return;

    const columns = Object.keys(pageData[0]).filter(key => key !== 'id');
    
    const filtered = pageData.filter(item => {
        return columns.some(col => {
            return String(item[col]).toLowerCase().includes(searchTerm.toLowerCase());
        });
    });

    renderTableBody(filtered, columns);
}

// Modal Functions
function openAddModal() {
    document.getElementById('addModal').classList.add('active');
}

function openEditModal(id) {
    selectedItem = id;
    document.getElementById('editModal').classList.add('active');
}

function openDeleteModal(id) {
    selectedItem = id;
    document.getElementById('deleteModal').classList.add('active');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
    selectedItem = null;
}

function confirmAdd() {
    const input = document.getElementById('addInput').value;
    if (input.trim()) {
        alert('Item added: ' + input);
        document.getElementById('addInput').value = '';
        closeModal('addModal');
        if (currentPage !== 'home') {
            loadTableData(currentPage);
        }
    }
}

function confirmEdit() {
    const input = document.getElementById('editInput').value;
    if (input.trim() && selectedItem) {
        alert('Item ' + selectedItem + ' edited: ' + input);
        document.getElementById('editInput').value = '';
        closeModal('editModal');
        if (currentPage !== 'home') {
            loadTableData(currentPage);
        }
    }
}

async function confirmDelete() {
    if (selectedItem) {
        const result = await deleteRecord(currentPage, selectedItem);
        
        if (result.success) {
            alert('‚úÖ ' + result.message);
            await loadAllData(); // Reload from database
            closeModal('deleteModal');
        } else {
            alert('‚ùå ' + result.message);
        }
    }
}
// Mobile Menu Toggle
function toggleMobileMenu() {
    const navMenu = document.getElementById('navMenu');
    if (navMenu.style.display === 'flex') {
        navMenu.style.display = 'none';
    } else {
        navMenu.style.display = 'flex';
        navMenu.style.flexDirection = 'column';
        navMenu.style.position = 'absolute';
        navMenu.style.top = '100%';
        navMenu.style.left = '0';
        navMenu.style.right = '0';
        navMenu.style.backgroundColor = '#667eea';
        navMenu.style.padding = '1rem';
        navMenu.style.zIndex = '999';
    }
}

// Close modals when clicking outside
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.classList.remove('active');
        selectedItem = null;
    }
}

// Side Panel Functions
function openPanel(id) {
    closeAllPanels();
    document.getElementById(id).classList.add('active');
}

function closePanel(id) {
    document.getElementById(id).classList.remove('active');
}

function closeAllPanels() {
    document.querySelectorAll('.side-panel').forEach(panel => panel.classList.remove('active'));
}

function saveSettings() {
    alert("Settings saved successfully!");
    closePanel('settingsPanel');
}

// Chart Initialization
function initializeCharts() {
    initTrafficChart();
    initEnergyChart();
    initPollutionChart();
    initEmergencyChart();
}

function initTrafficChart() {
    const ctx = document.getElementById('trafficChart');
    if (!ctx) return;

    const trafficLocations = data.traffic.map(t => t.location.substring(0, 15) + '...');
    const trafficCounts = data.traffic.map(t => t.vehicleCount);
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: trafficLocations,
            datasets: [{
                label: 'Vehicle Count',
                data: trafficCounts,
                backgroundColor: [
                    'rgba(239, 68, 68, 0.8)',
                    'rgba(251, 191, 36, 0.8)',
                    'rgba(239, 68, 68, 0.8)',
                    'rgba(34, 197, 94, 0.8)',
                    'rgba(251, 191, 36, 0.8)'
                ],
                borderColor: [
                    'rgb(239, 68, 68)',
                    'rgb(251, 191, 36)',
                    'rgb(239, 68, 68)',
                    'rgb(34, 197, 94)',
                    'rgb(251, 191, 36)'
                ],
                borderWidth: 2,
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: { display: false },
                title: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(0, 0, 0, 0.05)' },
                    title: {
                        display: true,
                        text: 'Number of Vehicles',
                        font: { size: 12, weight: 'bold' }
                    }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
}

function initEnergyChart() {
    const ctx = document.getElementById('energyChart');
    if (!ctx) return;

    const energyAreas = data.energy.map(e => e.area);
    const energyValues = data.energy.map(e => parseInt(e.energyConsumed));
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: energyAreas,
            datasets: [{
                label: 'Energy (kWh)',
                data: energyValues,
                backgroundColor: [
                    'rgba(59, 130, 246, 0.8)',
                    'rgba(239, 68, 68, 0.8)',
                    'rgba(34, 197, 94, 0.8)',
                    'rgba(251, 191, 36, 0.8)',
                    'rgba(168, 85, 247, 0.8)'
                ],
                borderColor: '#fff',
                borderWidth: 3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {
                        padding: 15,
                        font: { size: 11 }
                    }
                }
            }
        }
    });
}

function initPollutionChart() {
    const ctx = document.getElementById('pollutionChart');
    if (!ctx) return;

    const pollutionLocations = data.pollution.map(p => p.location);
    const aqiValues = data.pollution.map(p => p.aqi);
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: pollutionLocations,
            datasets: [{
                label: 'Air Quality Index',
                data: aqiValues,
                backgroundColor: aqiValues.map(val => {
                    if (val <= 50) return 'rgba(34, 197, 94, 0.8)';
                    if (val <= 100) return 'rgba(251, 191, 36, 0.8)';
                    if (val <= 150) return 'rgba(251, 146, 60, 0.8)';
                    return 'rgba(239, 68, 68, 0.8)';
                }),
                borderColor: aqiValues.map(val => {
                    if (val <= 50) return 'rgb(34, 197, 94)';
                    if (val <= 100) return 'rgb(251, 191, 36)';
                    if (val <= 150) return 'rgb(251, 146, 60)';
                    return 'rgb(239, 68, 68)';
                }),
                borderWidth: 2,
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(0, 0, 0, 0.05)' },
                    title: {
                        display: true,
                        text: 'AQI Value',
                        font: { size: 12, weight: 'bold' }
                    }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
}

function initEmergencyChart() {
    const ctx = document.getElementById('emergencyChart');
    if (!ctx) return;

    const incidents = ['Fire', 'Accident', 'Medical', 'Flood', 'Outage'];
    const responseTimes = [6.75, 8.5, 5.42, 25, 44.58];
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: incidents,
            datasets: [{
                label: 'Response Time (minutes)',
                data: responseTimes,
                backgroundColor: 'rgba(139, 92, 246, 0.2)',
                borderColor: 'rgb(139, 92, 246)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: 'rgb(139, 92, 246)',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: { font: { size: 12 } }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(0, 0, 0, 0.05)' },
                    title: {
                        display: true,
                        text: 'Minutes',
                        font: { size: 12, weight: 'bold' }
                    }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
}

// Set high DPI rendering for better graph quality
Chart.defaults.devicePixelRatio = 2;

// Check if user is logged in
const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));

if (!loggedInUser) {
    // Not logged in, redirect to login
    // window.location.href = "login.html";
    console.log('Login check bypassed for testing');
    // Create mock user for testing
    const mockUser = { username: 'testuser', role: 'user' };
    localStorage.setItem("loggedInUser", JSON.stringify(mockUser));
} else {
    // Display username
    const usernameDisplay = document.getElementById("usernameDisplay");
    if (usernameDisplay) {
        usernameDisplay.textContent = loggedInUser.username.charAt(0).toUpperCase() + loggedInUser.username.slice(1);
    }

    // If admin, show admin dashboard button in navbar
    if (loggedInUser.role === "admin") {
        const navMenu = document.getElementById("navMenu");
        const adminBtn = document.createElement('button');
        adminBtn.className = 'nav-item';
        adminBtn.style.background = 'rgba(16, 185, 129, 0.2)';
        adminBtn.style.border = '2px solid rgba(16, 185, 129, 0.5)';
        adminBtn.innerHTML = '<i class="fas fa-user-shield"></i><span>Admin Panel</span>';
        adminBtn.onclick = () => window.location.href = 'admin-dashboard.html';
        navMenu.appendChild(adminBtn);
    }
}

// Logout function
function logout() {
    if (confirm("Are you sure you want to logout?")) {
        localStorage.removeItem("loggedInUser");
        window.location.href = "logout.html";
    }
}

console.log('‚úÖ Smart Urban Development System Loaded Successfully');
console.log('üë§ Logged in as:', loggedInUser.username, '(' + loggedInUser.role + ')');
console.log('üìä Total Database Records:', {
    traffic: data.traffic.length,
    parking: data.parking.length,
    waste: data.waste.length,
    energy: data.energy.length,
    pollution: data.pollution.length,
    emergency: data.emergency.length,
    authorities: data.authorities.length,
    administrators: data.administrators.length,
    citizens: data.citizens.length
});
    </script>
</body>
</html>